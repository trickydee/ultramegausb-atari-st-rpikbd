================================================================================
OLED Debug Information - v7.1.0
================================================================================

The splash screens now show debug information to help diagnose the Xbox/PS4
reconnection issue WITHOUT needing a serial console.

================================================================================

XBOX CONTROLLER SPLASH SCREEN (3 seconds)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      XBOX!         â”‚  â† Large text
â”‚                    â”‚
â”‚    Xbox One        â”‚  â† Controller type
â”‚                    â”‚
â”‚  A:1 I:0 C:1       â”‚  â† Debug info
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Debug Line Breakdown:
  A:1  = Address (USB device address, typically 1-4)
  I:0  = Instance (interface number, usually 0)
  C:1  = Connected (1=connected, 0=not connected)

What to Look For:
âœ… C:1 = Controller is connected and should work
âŒ C:0 = Controller detected but not connected (PROBLEM!)

If you see C:0, this means:
- TinyUSB detected the Xbox controller
- But initialization failed or controller isn't ready
- This is likely why it doesn't work after PS4

================================================================================

PS4 CONTROLLER SPLASH SCREEN (2 seconds)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       PS4          â”‚  â† Large text
â”‚                    â”‚
â”‚   DualShock 4      â”‚  â† Controller type
â”‚                    â”‚
â”‚     Addr:1         â”‚  â† Debug info
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Debug Line Breakdown:
  Addr:1 = USB device address

What to Look For:
- Address should be 1, 2, 3, or 4
- Helps track if USB addresses are being reused

================================================================================

TEST SEQUENCE TO FOLLOW
================================================================================

Test 1: Xbox First (Should Work)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Flash new firmware
2. Plug in Xbox controller
3. Watch OLED: Should show "XBOX!" with "A:X I:X C:1"
4. Test controls - should work âœ…
5. Unplug Xbox

Test 2: Xbox After Xbox (Should Work)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6. Plug in Xbox again
7. Watch OLED: Should show "XBOX!" with "A:X I:X C:1"
8. Test controls - should work âœ…
9. Unplug Xbox

Test 3: PS4 (Should Work)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
10. Plug in PS4 controller
11. Watch OLED: Should show "PS4" with "Addr:X"
12. Test controls - should work âœ…
13. Unplug PS4

Test 4: Xbox After PS4 (THE PROBLEM TEST)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
14. Plug in Xbox controller
15. Watch OLED CAREFULLY:

    CASE A: Shows "XBOX!" with "A:X I:X C:1"
            â†’ Xbox IS connected
            â†’ If controls don't work, it's a data flow issue
            
    CASE B: Shows "XBOX!" with "A:X I:X C:0"
            â†’ Xbox detected but NOT connected â† LIKELY PROBLEM
            â†’ Initialization failed after PS4 usage
            â†’ This is what we need to fix
            
    CASE C: NO splash screen appears at all
            â†’ TinyUSB driver isn't detecting Xbox
            â†’ Major USB stack issue after PS4

16. Test controls and note whether they work

================================================================================

WHAT THE C:0 vs C:1 MEANS
================================================================================

C:1 (Connected)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… TinyUSB successfully enumerated the device
âœ… XInput driver initialized the controller
âœ… Endpoints opened successfully
âœ… Controller ready to send data
âœ… Should work normally

C:0 (Not Connected)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ TinyUSB detected the device
âŒ BUT: XInput initialization incomplete
âŒ Controller not ready to send data
âŒ Will NOT work

Common Causes of C:0:
- Xbox 360 Wireless waiting for sync
- Endpoint communication failed
- Init packet not acknowledged
- USB state confused after previous device

================================================================================

KEY DIAGNOSTIC QUESTIONS
================================================================================

After running Test 4 (Xbox after PS4), answer these:

Q1: Did the splash screen appear?
    YES â†’ TinyUSB detected the Xbox controller
    NO  â†’ TinyUSB driver not recognizing device

Q2: What was the C: value?
    C:1 â†’ Controller connected (good!)
    C:0 â†’ Controller detected but not connected (THIS IS THE BUG!)

Q3: Did the controls work?
    YES + C:1 â†’ Everything is working! ğŸ‰
    NO + C:1  â†’ Data flow issue (controller connected but data not flowing)
    NO + C:0  â†’ Expected (controller not connected)
    NO + No splash â†’ Major issue (Xbox not detected at all)

Q4: What address was shown?
    Same as before â†’ Good, consistent
    Different â†’ USB address changed (expected, but note it)

================================================================================

MOST LIKELY SCENARIO
================================================================================

Based on your description, when you do Test 4 (Xbox after PS4), you'll
probably see:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      XBOX!         â”‚
â”‚                    â”‚
â”‚    Xbox One        â”‚
â”‚                    â”‚
â”‚  A:X I:X C:0       â”‚  â† Notice C:0 here!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

This means:
- Xbox WAS detected by TinyUSB âœ…
- But initialization failed âŒ
- Controller not marked as "connected" âŒ

This tells us the fix needs to be in the XInput initialization sequence,
possibly related to how the controller state is managed after other USB
devices have been used.

================================================================================

NEXT STEPS AFTER TESTING
================================================================================

Please report back:
1. What you saw on the OLED for each test
2. Specifically the C: value in Test 4
3. Whether controls worked or not

This will tell us exactly where the problem is and how to fix it!

================================================================================

Firmware: v7.1.0 with OLED debug info
Files: dist/atari_ikbd_pico.uf2 or dist/atari_ikbd_pico2.uf2
Date: October 21, 2025

